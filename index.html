<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Face Labels Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center">

  <h1 class="text-2xl font-bold mt-6 mb-4">üì∏ Face Images with Labels</h1>

  <!-- Container for images -->
  <div id="imageContainer" class="grid grid-cols-2 md:grid-cols-4 gap-4 p-4 w-full max-w-6xl"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref as dbRef, get } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
    import { getStorage, ref as sRef, listAll, getDownloadURL, getMetadata } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "XXXXXX",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const storage = getStorage(app);

    async function loadImagesWithLabels() {
      const container = document.getElementById("imageContainer");
      container.innerHTML = ""; // Clear old content

      // 1Ô∏è‚É£ Get labels from Firebase Realtime Database
      const labelsSnap = await get(dbRef(db, "labels"));
      const labels = labelsSnap.exists() ? labelsSnap.val() : {};

      // 2Ô∏è‚É£ List all images in Firebase Storage folder "unlabeled"
      const storageFolder = sRef(storage, "unlabeled");
      const files = await listAll(storageFolder);

      // 3Ô∏è‚É£ Fetch metadata for sorting by upload time
      const filesWithMeta = await Promise.all(
        files.items.map(async (fileRef) => {
          const meta = await getMetadata(fileRef);
          return { fileRef, meta };
        })
      );

      // Sort by most recent upload first
      filesWithMeta.sort((a, b) => new Date(b.meta.timeCreated) - new Date(a.meta.timeCreated));

      // 4Ô∏è‚É£ For each file, get download URL and match label
      for (const { fileRef } of filesWithMeta) {
        const url = await getDownloadURL(fileRef);
        const filename = fileRef.name;
        const label = labels[filename] || "Unknown";

        // Create card
        const card = document.createElement("div");
        card.className = "flex flex-col items-center p-2 bg-white border rounded shadow hover:shadow-lg transition";

        // Image
        const img = document.createElement("img");
        img.src = url;
        img.alt = filename;
        img.className = "w-40 h-40 object-cover rounded";

        // Label
        const caption = document.createElement("p");
        caption.textContent = label;
        caption.className = "mt-2 font-semibold text-gray-800";

        card.appendChild(img);
        card.appendChild(caption);
        container.appendChild(card);
      }
    }

    // Load immediately and refresh every 10 seconds
    loadImagesWithLabels();
    setInterval(loadImagesWithLabels, 10000);
  </script>
</body>
</html>
