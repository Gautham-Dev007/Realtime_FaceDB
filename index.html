<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Face Recognition Control Panel</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f4f4f4;
        margin: 0;
        padding: 0;
        text-align: center;
    }
    h1 {
        background: #4CAF50;
        color: white;
        padding: 15px;
        margin: 0 0 20px;
    }
    #controls {
        margin-bottom: 20px;
    }
    button {
        padding: 10px 20px;
        margin: 5px;
        border: none;
        background: #4CAF50;
        color: white;
        font-size: 16px;
        cursor: pointer;
        border-radius: 5px;
    }
    button.stop {
        background: #f44336;
    }
    button:hover {
        opacity: 0.9;
    }
    #status {
        font-weight: bold;
        margin: 10px 0;
    }
    .error {
        color: red;
    }
    #image-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
    }
    .image-box {
        margin: 10px;
        background: white;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .image-box img {
        max-width: 200px;
        display: block;
        border-radius: 5px;
    }
</style>
</head>
<body>

<h1>Face Recognition Remote Control</h1>

<div id="controls">
    <button id="startBtn">Start Recognition</button>
    <button id="stopBtn" class="stop">Stop Recognition</button>
    <div id="status">Status: <span id="statusText">Loading...</span></div>
    <div class="error" id="errorMsg"></div>
</div>

<h2>Saved Images</h2>
<div id="image-container"></div>

<script>
const DB_URL = "https://faceuploader-3347e-default-rtdb.firebaseio.com";
const CONTROL_PATH = `${DB_URL}/control/start_recognition.json`;
const STATUS_PATH = `${DB_URL}/status.json`;
const IMAGES_PATH = `${DB_URL}/images.json`;

// Start Recognition
document.getElementById("startBtn").onclick = () => {
    fetch(CONTROL_PATH, {
        method: "PUT",
        body: "true"
    }).catch(() => {
        document.getElementById("errorMsg").textContent = "Error: Cannot contact Firebase!";
    });
};

// Stop Recognition
document.getElementById("stopBtn").onclick = () => {
    fetch(CONTROL_PATH, {
        method: "PUT",
        body: "false"
    }).catch(() => {
        document.getElementById("errorMsg").textContent = "Error: Cannot contact Firebase!";
    });
};

// Update Status
function fetchStatus() {
    fetch(STATUS_PATH)
        .then(res => res.json())
        .then(data => {
            document.getElementById("errorMsg").textContent = "";
            if (data && data.running) {
                document.getElementById("statusText").textContent = "Running ✅";
            } else {
                document.getElementById("statusText").textContent = "Stopped ⛔";
            }
        })
        .catch(() => {
            document.getElementById("statusText").textContent = "Unknown";
            document.getElementById("errorMsg").textContent = "Python app not reachable!";
        });
}

// Fetch Images
function fetchImages() {
    fetch(IMAGES_PATH)
        .then(res => res.json())
        .then(data => {
            const container = document.getElementById("image-container");
            container.innerHTML = "";
            if (!data) return;
            Object.values(data).forEach(url => {
                const box = document.createElement("div");
                box.className = "image-box";
                const img = document.createElement("img");
                img.src = url;
                box.appendChild(img);
                container.appendChild(box);
            });
        })
        .catch(() => {
            document.getElementById("errorMsg").textContent = "Error loading images!";
        });
}

// Refresh every 2s
setInterval(() => {
    fetchStatus();
    fetchImages();
}, 2000);

fetchStatus();
fetchImages();
</script>

</body>
</html>
