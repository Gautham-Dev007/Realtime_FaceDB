<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Face Capture Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
  <!-- Navigation Tabs -->
  <div class="bg-white shadow p-4 flex space-x-4">
    <button onclick="showTab('status')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">📊 Status</button>
    <button onclick="showTab('faces')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">🖼 Faces</button>
    <button onclick="showTab('settings')" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">⚙️ Settings</button>
  </div>

  <!-- Status Tab -->
  <div id="status" class="tab-content p-6">
    <h2 class="text-2xl font-bold mb-4">📊 Recognition Status</h2>
    <div id="statusInfo" class="bg-white p-4 rounded shadow">
      Loading status...
    </div>
  </div>

  <!-- Faces Tab -->
  <div id="faces" class="tab-content hidden p-6">
    <h2 class="text-2xl font-bold mb-4">🖼 Captured Faces</h2>
    <div class="mb-4 flex space-x-2">
      <button onclick="loadFaces()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">🔄 Refresh</button>
      <button onclick="deleteAllImages()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">🗑 Delete All</button>
    </div>
    <div id="facesGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
  </div>

  <!-- Settings Tab -->
  <div id="settings" class="tab-content hidden p-6">
    <h2 class="text-2xl font-bold mb-4">⚙️ Settings</h2>

    <!-- Photo interval slider -->
    <label class="block mb-2 font-medium">
      Photo Capture Interval: <span id="intervalDisplay">10</span> sec
    </label>
    <input type="range" id="photoIntervalSlider" min="1" max="60" value="10" class="w-64 mb-4">

    <!-- Auto schedule -->
    <h3 class="text-lg font-semibold mt-6 mb-2">Auto Start/Stop Schedule</h3>
    <label class="block mb-1">Start Time:</label>
    <input type="time" id="startTime" class="border p-2 rounded w-40 mb-3">
    
    <label class="block mb-1">Stop Time:</label>
    <input type="time" id="stopTime" class="border p-2 rounded w-40 mb-4">

    <button onclick="saveSchedule()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
      💾 Save Schedule
    </button>
  </div>

  <script>
    const FIREBASE_DB_URL = "https://your-project.firebaseio.com"; // <-- change this

    // Tab switching
    function showTab(tabId) {
      document.querySelectorAll(".tab-content").forEach(el => el.classList.add("hidden"));
      document.getElementById(tabId).classList.remove("hidden");
      if (tabId === "settings") loadSettings();
    }

    // Fetch status
    async function fetchStatus() {
      try {
        const res = await fetch(`${FIREBASE_DB_URL}/status.json`);
        const data = await res.json();
        document.getElementById("statusInfo").innerHTML = `
          <p><strong>Running:</strong> ${data?.running ? "✅ Yes" : "❌ No"}</p>
          <p><strong>Last Active:</strong> ${data?.last_active || "N/A"}</p>
          <p><strong>Errors:</strong> ${data?.errors || "None"}</p>
        `;
      } catch {
        document.getElementById("statusInfo").innerHTML = "⚠️ Failed to load status.";
      }
    }

    // Load captured faces
    async function loadFaces() {
      const grid = document.getElementById("facesGrid");
      grid.innerHTML = "Loading...";
      try {
        const res = await fetch(`${FIREBASE_DB_URL}/faces.json`);
        const faces = await res.json();
        grid.innerHTML = "";
        if (faces) {
          Object.values(faces).forEach(url => {
            const img = document.createElement("img");
            img.src = url;
            img.className = "rounded shadow";
            grid.appendChild(img);
          });
        } else {
          grid.innerHTML = "No images found.";
        }
      } catch {
        grid.innerHTML = "⚠️ Failed to load images.";
      }
    }

    // Delete all images
    async function deleteAllImages() {
      if (!confirm("Are you sure you want to delete all images?")) return;
      await fetch(`${FIREBASE_DB_URL}/faces.json`, { method: "DELETE" });
      loadFaces();
    }

    // Load settings
    async function loadSettings() {
      try {
        const settingsRes = await fetch(`${FIREBASE_DB_URL}/settings.json`);
        const settings = await settingsRes.json();
        if (settings?.upload_cooldown) {
          document.getElementById("photoIntervalSlider").value = settings.upload_cooldown;
          document.getElementById("intervalDisplay").textContent = settings.upload_cooldown;
        }
        const scheduleRes = await fetch(`${FIREBASE_DB_URL}/schedule.json`);
        const schedule = await scheduleRes.json();
        if (schedule?.start_time) document.getElementById("startTime").value = schedule.start_time;
        if (schedule?.stop_time) document.getElementById("stopTime").value = schedule.stop_time;
      } catch (err) {
        console.error("Error loading settings:", err);
      }
    }

    // Live update interval
    document.getElementById("photoIntervalSlider").addEventListener("input", async (e) => {
      const newVal = parseInt(e.target.value);
      document.getElementById("intervalDisplay").textContent = newVal;
      await fetch(`${FIREBASE_DB_URL}/settings.json`, {
        method: "PATCH",
        body: JSON.stringify({ upload_cooldown: newVal })
      });
    });

    // Save schedule
    async function saveSchedule() {
      const start = document.getElementById("startTime").value;
      const stop = document.getElementById("stopTime").value;
      await fetch(`${FIREBASE_DB_URL}/schedule.json`, {
        method: "PUT",
        body: JSON.stringify({ start_time: start, stop_time: stop })
      });
      alert("✅ Schedule saved!");
    }

    // Auto refresh
    setInterval(fetchStatus, 5000);
    setInterval(loadFaces, 10000); // Optional auto-refresh for faces

    // Init
    fetchStatus();
    loadFaces();
  </script>
</body>
</html>
