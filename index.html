<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Face Recognition Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
    header { background: #333; color: #fff; padding: 15px; text-align: center; font-size: 1.5em; }
    .container { padding: 20px; max-width: 1000px; margin: auto; }
    .controls, .alerts { margin-bottom: 20px; }
    button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
    .start { background: #28a745; color: #fff; }
    .stop { background: #dc3545; color: #fff; }
    .refresh { background: #007bff; color: #fff; }
    .download { background: #17a2b8; color: #fff; }
    .delete { background: #ffc107; color: #000; }
    .gallery { display: flex; flex-wrap: wrap; gap: 15px; }
    .image-card { background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); text-align: center; width: 200px; }
    .image-card img { max-width: 100%; border-radius: 8px; }
  </style>
</head>
<body>

<header>Face Recognition Dashboard</header>

<div class="container">

  <!-- Recognition Controls -->
  <div class="controls">
    <h2>Recognition Controls</h2>
    <button class="start" onclick="setRecognition(true)">Start Recognition</button>
    <button class="stop" onclick="setRecognition(false)">Stop Recognition</button>
    <p>Status: <span id="status">Loading...</span></p>
  </div>

  <!-- Alerts Toggle -->
  <div class="alerts">
    <h2>Alerts</h2>
    <label>
      <input type="checkbox" id="alertsToggle" onchange="toggleAlerts()"> Enable Alerts
    </label>
  </div>

  <!-- Gallery Controls -->
  <div class="gallery-controls">
    <h2>Captured Images</h2>
    <button class="refresh" onclick="loadImages()">Refresh</button>
    <button onclick="selectAll()">Select All</button>
    <button onclick="deselectAll()">Deselect All</button>
    <button class="download" onclick="downloadSelected()">Download Selected</button>
    <button class="delete" onclick="deleteSelected()">Delete Selected</button>
  </div>

  <!-- Gallery -->
  <div class="gallery" id="gallery"></div>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- JSZip for downloads -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
  // TODO: Replace with your Firebase config
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Recognition Control
  function setRecognition(state) {
    db.ref("recognition_status").set(state ? "active" : "stopped");
  }

  // Update Status
  db.ref("recognition_status").on("value", snapshot => {
    document.getElementById("status").textContent = snapshot.val() || "unknown";
  });

  // Alerts Toggle
  function toggleAlerts() {
    db.ref("alerts_enabled").set(document.getElementById("alertsToggle").checked);
  }
  db.ref("alerts_enabled").on("value", snap => {
    document.getElementById("alertsToggle").checked = !!snap.val();
  });

  // Load Images
  function loadImages() {
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";
    db.ref("captured_images").once("value", snapshot => {
      snapshot.forEach(child => {
        const key = child.key;
        const base64Data = child.val();
        const div = document.createElement("div");
        div.className = "image-card";
        div.innerHTML = `
          <input type="checkbox" class="img-select" data-key="${key}">
          <img src="${base64Data}" alt="Captured Face">
        `;
        gallery.appendChild(div);
      });
    });
  }

  // Select/Deselect
  function selectAll() {
    document.querySelectorAll(".img-select").forEach(cb => cb.checked = true);
  }
  function deselectAll() {
    document.querySelectorAll(".img-select").forEach(cb => cb.checked = false);
  }

  // Download Selected
  function downloadSelected() {
    const zip = new JSZip();
    const selected = document.querySelectorAll(".img-select:checked");
    if (!selected.length) { alert("No images selected."); return; }
    let count = 0;
    selected.forEach(cb => {
      const key = cb.dataset.key;
      db.ref("captured_images/" + key).once("value", snap => {
        const imgData = snap.val().split(",")[1]; // remove data:image/png;base64,
        zip.file(`${key}.png`, imgData, { base64: true });
        count++;
        if (count === selected.length) {
          zip.generateAsync({ type: "blob" }).then(content => saveAs(content, "selected_images.zip"));
        }
      });
    });
  }

  // Delete Selected
  function deleteSelected() {
    const selected = document.querySelectorAll(".img-select:checked");
    if (!selected.length) { alert("No images selected."); return; }
    if (!confirm("Are you sure you want to delete selected images?")) return;
    selected.forEach(cb => {
      db.ref("captured_images/" + cb.dataset.key).remove();
    });
    loadImages();
  }

  // Initial load
  loadImages();
</script>

</body>
</html>
